package cc.chinagps.gateway.unit.beforemarket.yidongwang.upload.beans;

import org.seg.lib.util.Util;

import cc.chinagps.gateway.aplan.pkg.APlanUtil;
import cc.chinagps.gateway.unit.beans.BaseStationInfo;
import cc.chinagps.gateway.unit.beforemarket.common.pkg.BeforeMarketPackage;
import cc.chinagps.gateway.util.HexUtil;

public class YdwTest {
	public static void main(String[] args) {
		String s = "7d11023553330585814741000200320028c616071806515382000d76dcc243786af20000006400000000000004343630303025f2a32200000004bc0000119464647cc57d";
		
		s = "7D1102355333058580264100E600320028C616071806574482000D8A658A437F6E92000000640000000000000434363030302677FF920000001DBE0001110C646485AE7D";
		
		s = "7d1102355333058528030100010027014342422d31303000000000000000000000000000000000000000000000000000000031353033e0b97d";
		//一动网主动上报位置0x4128 ok
		s = "7d11023553330585275141004a00320028c6160719010823818c101869e64254f4ec005c0064000000000000003436303031739928ab0000000918000013ec6464b7367d";
		
		s = "7d11023553330585275141004c00320028c61607190108538185101867704254cd0a00990064000000000000003436303031739928ab00000009360000145064643f807d";
		
		s = "7d11023553330585275141004e00320028c61607190109238183101866ee4254a94c006c0064000000000000003436303031739928ab0000000954000014b46464d4207d";
		
		//心跳包 ok
		//s = "7d11023553330585275101004b000102c74c7d";
		
		//报警数据0x4129 
		s = "7d11023553330585812341000200320029c6160511024536c1000d8339b8437543a40000000008000000000004343630303027d59db40000000000000000006464b92e7d";
		//seg log
		s = "7d11023553330580655801004b000102e23a7d2d313030000000000000000000000000000000000000000000000000000000313530336ab17d";
		
		//seg log
		s = "7d11023553330585280301000200010209117d";
		
		s = "7d11023553330585275141005d00328028c61607190515538200101925de4257ead000000064000000000000003436303031739945bb000000162c00004074646426337d";
		
		s = "7d11023553330585275141003e00328028c61607190505538200101925de4257ead000000064000000000000003436303031739945bb000000162c00004074646478e17d";
		
		
		s = "7d11023553330585275141002000328028c61607190455538200101925de4257ead000000064000000000000003436303031739945bb000000162c000040746464b7577d";
		
		//登录包
		s = "7d1102355333058527510100010027014342422d31303000000000000000000000000000000000000000000000000000000031353033d8947d";
		
		s = "7d1102355333058527510100010027014342422d31303000000000000000000000000000000000000000000000000000000031353033d8947d";
		
		s = "7d1102355333058527510100040001027e013e7d";
		
		s = "7d11023553330580655841000200328028c616071907280882000d7813d04398773e000000640000000000000434363030302549c7b600000000000000000064644e817d";
		
		s = "7d11023553330585280341000200328028c616072006490781500d8413b04376e74000f3006400000000000004343630303027d5ffba00000005d0000019c86464b4d77d";
		
		s = "7d11023553330585590441000200328028c61607200821238246103c12ce4273c09800000064000000000000043436303031739a2c580000000a6500002e1864643a917d";
		
		s = "7d11023553330585716541000200328028c61607200846088171119642ca471de0b002b9006400000000000000343630303058ab8fcb0000007d";
		
		s = "7d11023553330585716541000200328028c61607200846088171119642ca471de0b002b9006400000000000000343630303058ab8fcb0000000b280000708064644d727d";
		try {
			BeforeMarketPackage pkg = BeforeMarketPackage.parse(HexUtil.hexToBytes(s), 1, 2);
			byte[] body = pkg.getBody();
			byte flag0 = body[0];
			int subCmdId = body[1] & 0xFF;
			
			boolean needAnswer = (flag0 & 0x80) != 0;
			boolean isHistory = (flag0 & 0x1) != 0;
			System.out.println("subCmdId:"+subCmdId+";needAnswer:"+needAnswer+";isHistory:"+isHistory);
			byte dataFlag = body[2];
			boolean hasBaseStation = (dataFlag & 0x4) != 0;
			boolean hasYdwInfo = (dataFlag & 0x2) != 0;
			
			int position = 3;
			YdwGPSInfo gpsInfo = YdwGPSInfo.parse(body, position);
			position += 20;
			System.out.println(gpsInfo);
			YdwStatus status = YdwStatus.parse(body, position);
			position += 7;
			System.out.println(status);
			BaseStationInfo baseStationInfo = null;
			if(hasBaseStation){
				String plmn = APlanUtil.getCString(body, position, 5);
				position += 5;
				int lac = Util.getShort(body, position) & 0xFFFF;
				position += 2;
				int cid = Util.getShort(body, position) & 0xFFFF;
				position += 2;
				
				baseStationInfo = new BaseStationInfo();
				baseStationInfo.setMcc(plmn.substring(0, 3));
				baseStationInfo.setMnc(plmn.substring(3));
				baseStationInfo.setLac(lac);
				baseStationInfo.setCid(cid);
			}
			System.out.println(baseStationInfo);
			YdwInfo ydwInfo = null;
			if(hasYdwInfo){
				ydwInfo = YdwInfo.parse(body, position);
				position += 11;
			}
			System.out.println(ydwInfo);
			
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	
	}
}
